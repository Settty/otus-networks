#  eBGP. Основы

###  Задание:

BGP. Основы

Цель: Настроить BGP между автономными системами.

Организовать доступность между офисами Москва и С.-Петербург

1. eBGP между офисом Москва и двумя провайдерами - Киторн и Ламас
2. Настроите eBGP между провайдерами Киторн и Ламас
3. Настроите eBGP между Ламас и Триада
4. eBGP между офисом С.-Петербург и провайдером Триада
5. Организуете IP доступность между офисами Москва и С.-Петербург

### Схема сети

![](Schema.png)


- [Конфигурационные файлы](config/)

### Схема сети

![](Schema1.png)


### Адресация между AS по BGP

Киторн (AS101) - Москва (AS1001)

| Network IPv4     | Network IPv6    |  Eq&port          |
|-----------------:|:---------------|-------------------------:|
| 50.50.50.0/28    | 20AA:BBCC:50:50::/64   | R22e0/0  R14e0/2 |

Ламас (AS301) - Москва (AS1001)
| Network IPv4     | Network IPv6    |  Eq&port          |
|-----------------:|:---------------|-------------------------:|
| 60.60.60.0/28    | 20AA:BBCC:60:60::/64   | R21e0/0  R15e0/2 |

Киторн (AS101) - Ламас (AS301)

| Network IPv4     | Network IPv6    |  Eq&port          |
|-----------------:|:---------------|-------------------------:|
| 70.70.70.0/28    | 20AA:BBCC:70:70::/64   | R22e0/1  R21e0/1 |

Ламас (AS301) - Триада (AS520)
| Network IPv4     | Network IPv6    |  Eq&port          |
|-----------------:|:---------------|-------------------------:|
| 90.90.90.0/28    | 20AA:BBCC:90:90::/64   | R21e0/2  R24e0/0 |

Триада (AS520) - С.Питербург (AS 2042)
| Network IPv4     | Network IPv6    |  Eq&port          |
|-----------------:|:---------------|-------------------------:|
| 100.100.100.0/28    | 20AA:BBCC:100:100::/64   | R24e0/3  R18e0/2 |
| 110.110.110.0/28    | 20AA:BBCC:110:110::/64   | R26e0/3  R18e0/3 |








### Конфигурация маршрутизаторов сводиться к следующим настройкам:

1. Включаем на всех роутерах процес BGP с номером AS согласно схемы. 
          
       RX(config)#router BGP X - где X номер автономной системы. 
       
 Роутеры учавствующие в обмене BGP Update:
 
    R14 - Москва 
    R15 - Москва
    R21 - Ламас 
    R22 - Киторн
    R24 - Триада 
    R26 - Триада 
    R18 - С.Питербург
 
2. Назначаем на каждом роутере Router ID для BGP

       RX(config)#router bgp X
       RX(config-router)#bgp router-id x.x.x.x - где x.x.x.x номер роутера согласно схемы. R14 - router-id 14.14.14.14
     
     
3. Устанавливаем сосдество по BGP согласно задания.

       R14 - Москва (50.50.50.2)  -  R22 - Киторн (50.50.50.1)
       R15 - Москва (60.60.60.2)  -  R21 - Ламас (60.60.60.1)
       R21 - Киторн (70.70.70.1)  -  R22 - Ламас (70.70.70.2)
       R22 - Ламас (90.90.90.1)   -  R24 - Триада (90.90.90.2)
       R24 - Триада (100.100.100.1)- R18 - С.Питербург (100.100.100.2)
       R26 - Триада (110.110.110.1)- R18 - С.Питербург (110.110.110.2)
       
  Для установления BGP соседства необходимо на каждом роутере указать команду:
  
       RX(config)#router bgp X
       RX(config-router)#neighbor x.x.x.x remote-as Z - где x.x.x.x IP соседа с кем устанавливается BGP, а Z - номер автономной системы BGP соседа
       
### Пример R14 Москва - R22 Киторн
  
       R14(config)#router bgp 1001
       R14(config-router)#neighbor 50.50.50.1 remote-as 101
       
### Пример R22 Киторн - R14 Москва
  
       R14(config)#router bgp 101
       R14(config-router)#neighbor 50.50.50.2 remote-as 1001       
       
  После выполнения данных команд на каждом роутере создается BGP соседвство.
  
### Пример роутера R21 Ламас AS 301

![](bgp_0_ad.png)

Как видно из скриншота, установлено только BGP соседство, но не одна из сетей не анонсирована. На это указывает последний столбец из скриншота State/PfxRcd с числом 0.


## Для выполнения задания по организации IP связанности между офисами Москва и С.Питербург необходимо:

## 1. Добавить в анонс BGP конечные сети пользователей

       Москва - 192.168.20.0/24 и 192.168.30.0/24
       Питер  - 192.168.40.0/24 и 192.168.50.0/24
       
 Для Москвы на роутерах R14 и R15 выполнить:
    
      R14-15(config)#router bgp 1001
      R14-15(config-router)#network 192.168.20.0   
      R14-15(config-router)#network 192.168.30.0
      
  Для Питера на роутере R18 выполнить:
      
      R18(config)#router bgp 2042
      R18(config-router)#network 192.168.40.0
      R18(config-router)#network 192.168.40.0
      
  #### Пример роутера R21 Ламас AS 301    
      
  ![](bgp_2_ad.png)  
  
  Как видно из скриншота, установлено BGP соседство и анонсировано по 2 сети от роутеров. На это указывает последний столбец из скриншота State/PfxRcd с числом 2.
  
  Так же в таблицу маршрутизации R21 добавилось 4 маршрута BGP от R14 R15 и R18
  
  ![](bgp_r21.png)
  
  #### В таблицу маршрутизации роутеров R14 и R15 так же добавились маршруты BGP до сетей 192.168.40.0 /24 и 192.168.50.0 24 от R18
  
  ![](bgp_r14.png)
  
  ![](bgp_r15.png)
  
  
  #### В таблицу маршрутизации роутера R18 так же добавились маршруты BGP до сетей 192.168.20.0 /24 и 192.168.30.0 24 от R14 и R15
  
  ![](bgp_r18.png)

## 2. Выполнить редистрибуцию маршрутов из BGP в протокол IGP.

Редистрибуцию маршрутов необходимо выполнить только для EIGRP в Питере т.к. в Москве согласно предыдущего задания по OSPF на роутерах R14 и R15 выполнена команда default-information originate и каждый роутер находящийся в AS1001 получает O*E2  0.0.0.0/0 [110/1]. Соответсвенно весь трафик с неизвестными сетями роутеры в AS 1001 направляют на пограничные роутеры R14 и R15

Для выполнения редистрибуции из BGP в EIGRP (Питер) необходимо на роутере R18 выполнить следующие команды:

     R18(config)#router eigrp PITER
     R18(config-router)#address-family ipv4 unicast autonomous-system 100
     R18(config-router-af)#topology base
     R18(config-router-af-topology)#redistribute bgp 2042 metric 10000 10 255 1 1500
     
После выполнения данных команд на всех маршрутизаторах EIGRP появятся маршруты D EX  192.168.20.0/24 и D EX  192.168.30.0/24 из Москвы AS 1001.

Ниже таблица маршрутизации L3 коммутатора SW9 как наиболее близкого хоста расположенного к пользовательской сети.

![](eigrp_sw9.png)

Далее проверяем IP связанность и трассировку между офисами Москва и Питер.

![](ping.png)

![](trace.png)
     
